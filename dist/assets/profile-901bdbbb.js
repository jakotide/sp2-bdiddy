import"./main-af214c2d.js";import{l as d,a as b}from"./hamburger-5bbfc2df.js";import{g as x}from"./getProfile-c65c363c.js";import{A as I,L as q,P as D}from"./constants-88326297.js";import{g as C}from"./headers-246ce9a4.js";async function T(o){if(!o)throw new Error("Delete listing requires ID.");const t=`${I}${q}${o}`;try{const e=await fetch(t,{method:"DELETE",headers:C()});if(!e.ok)throw new Error(`Failed to delete listing. Status: ${e.status}`);const n=e.headers.get("content-type");if(n&&n.includes("application/json")){const s=await e.json();console.log(s)}else console.log("Listing deleted successfully.")}catch(e){console.error("Error:",e)}}async function k(){const o=d("User");if(!o||!o.name)throw new Error("Cannot find User");try{const{name:t}=d("User"),e=await x(t),n=document.querySelector(".name"),s=document.querySelector("#profileImage"),u=document.querySelector(".email"),a=document.querySelector(".wins"),E=document.querySelector(".funds"),w=document.querySelector(".listingAmount"),S=document.querySelector(".profile-card-container");s.src=e.avatar,s.alt=`${e.name}'s Profile Image`,n.textContent=e.name,u.textContent=e.email,E.textContent="Funds: "+e.credits+"$",Array.isArray(e.wins)&&e.wins.length===0?a.textContent+=`Number of Wins: ${e.wins.length}`:a.textContent+="No wins yet.",Array.isArray(e.listings)&&e.listings.length===0?w.textContent="No listings yet.":Array.isArray(e.listings)?w.textContent=`Listings: ${e.listings.length}`:console.log(error),e.listings.forEach(r=>{const y=document.createElement("div");y.classList.add("profile-card","border");const c=document.createElement("img");if(!r.media||r.media===" ")cardImage.src="/assets/img/noimage.jpg";else{const g=new Image;g.src=r.media,g.onload=function(){c.src=r.media,c.alt="Image of "+r.title},g.onerror=function(){c.src="/assets/img/noimage.jpg",c.alt="No image available"}}const L=document.createElement("div");L.textContent=r.title;const f=document.createElement("div");f.classList.add("btn-container");const l=document.createElement("a");l.textContent="Delete",l.classList.add("deleteBtn"),l.addEventListener("click",()=>B(r.id));const i=document.createElement("a");i.textContent="View",i.href="/sp2-bdiddy/listing/?id="+r.id,i.classList.add("viewBtn"),f.append(l,i),y.append(c,L,f),S.append(y)})}catch(t){console.error("Error fetching user profile:",t.message)}}const p=document.getElementById("overlay");function B(o){const t=document.getElementById("deleteModal");gsap.set(t,{y:-50,opacity:0}),p.style.display="block",t.style.display="block",gsap.to(t,{duration:.8,ease:"elastic.out(1.2, 0.5)",y:0,x:0,opacity:1});const e=document.getElementById("confirmDelete"),n=document.getElementById("cancelDelete");e.onclick=()=>$(o),n.onclick=h,document.body.classList.add("modal-open"),p.onclick=()=>{h()}}function h(){const o=document.getElementById("deleteModal");p.style.display="none",o.style.display="none",document.body.classList.remove("modal-open")}const A=document.querySelector(".delete-text");async function $(o){try{b(async()=>{await T(o),A.textContent="Listing successfully deleted.",setTimeout(()=>{h(),location.reload()},1500)},()=>{console.error("Invalid token")})}catch(t){console.error("Error handling delete:",t)}}async function N(o){const t=d("User");try{t||console.log("Need username");const e=await fetch(`${I}${D}${t.name}/media`,{method:"PUT",headers:C(),body:JSON.stringify({avatar:o.avatar})});if(e.ok)return await e.json();console.log(e.statusText)}catch(e){throw e}}function U(){const o=document.querySelector(".profile-img-form"),t=document.querySelector("#successBtn");if(o){let e=d("User");o.addEventListener("submit",async n=>{n.preventDefault();const s=n.target,u=new FormData(s),a=Object.fromEntries(u.entries());if(a.name=e,!!a.avatar)try{t.innerHTML='<span class="loader"></span>',await N(a),t.innerText="Success",setTimeout(()=>{location.reload()},600)}catch{console.log("error")}})}}const m=document.querySelector("[data-modal]"),M=document.querySelector("[data-close-modal]"),P=document.querySelector("[data-open-modal]"),v=document.querySelector("#profile-url");k();U();gsap.set(m,{y:-50,opacity:1});P.addEventListener("click",()=>{v.disabled=!1,m.showModal(),gsap.to(m,{duration:1,ease:"elastic.out(1.2,0.5)",y:0,opacity:1})});M.addEventListener("click",()=>{v.disabled=!0,m.close()});
